{% extends "base.html" %}

{% block content %}
<style>
    /* é‡ç½®æ‰€æœ‰å…ƒç´ çš„marginå’Œpadding */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* ç¡®ä¿htmlå’Œbodyå…ƒç´ å æ»¡æ•´ä¸ªè§†å£ */
    html, body {
        width: 100%;
        height: 100%;
        overflow: auto;
    }

    /* ä¸»å®¹å™¨å æ»¡æ•´ä¸ªçˆ¶å…ƒç´  */
    .container {
        display: grid;
        grid-template-columns: 3fr 1fr; /* å·¦2/3ï¼Œå³1/3 */
        width: 100%;
        height: 100vh; /* ä½¿ç”¨è§†å£é«˜åº¦å•ä½ */
        gap: 10px;
        padding: 10px;
    }

    .left-panel {
        display: grid;
        grid-template-rows: 1fr 1fr; /* ä¸Šä¸‹ç­‰åˆ† */
        gap: 10px;
        height: 100vh; /* ç¡®ä¿é«˜åº¦å æ»¡çˆ¶å®¹å™¨ */
    }

    .left-top {
        display: grid;
        grid-template-columns: 3fr 4fr; /* å·¦å³ç­‰åˆ† */
        gap: 10px;
        height: 100%; /* ç¡®ä¿é«˜åº¦å æ»¡çˆ¶å®¹å™¨ */
    }

    .module {
    background-color: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 5px;
    color: white;
    height: 100%; /* ç¡®ä¿é«˜åº¦å æ»¡çˆ¶å®¹å™¨ */
    overflow: hidden; /* ä¿®æ”¹ä¸º auto ä»¥æ˜¾ç¤ºæ»šåŠ¨æ¡ */
}


    .module-title {
        text-align: center;
        color: #00c3ff;
        margin-bottom: 10px;
        font-size: 18px;
    }

    .right-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
    height: 100vh; /* å‡å» padding å’Œ gap çš„å½±å“ */
}

.combined-module {
    background-color: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 5px;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100%; /* ç¡®ä¿é«˜åº¦å æ»¡çˆ¶å®¹å™¨ */
    overflow: auto; /* ä¿®æ”¹ä¸º auto ä»¥æ˜¾ç¤ºæ»šåŠ¨æ¡ */
    flex: 1; /* ç¡®ä¿æ¨¡å—å¡«æ»¡å¯ç”¨ç©ºé—´ */
    min-height: 0; /* å…è®¸å†…å®¹è¢«å‹ç¼© */
}

/*åœ°å›¾å®¹å™¨å¤§å° begin*/
    #map-container {
        width: 705px;
        height: 460px;
        /* left:-10px; */
    }
/* åœ°å›¾ end */

/* å·¦ä¸Š start */
/* ä¸Šéƒ¨åˆ†ï¼šæ€»é‡ä¸ä»Šæ—¥æ–°å¢ */
    .total-data {
        position: relative;       /* å…³é”®ï¼šè®¾ç½®ä¸ºå®šä½ä¸Šä¸‹æ–‡ */
        display: inline-block;    /* ä¿è¯å®¹å™¨å¤§å°è´´åˆå†…å®¹ */
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        gap: 10px;
    }
    .digit-boxes {
        display: flex;
        gap: 4px;
        margin-left: 20px;
    }
    .digit-box {
      background: #003d66;
      padding: 8px 10px;
      border-radius: 6px;
      font-size: 26px;
      min-width: 26px;
      text-align: center;
    }
    .unit {
        position: absolute;       /* å…³é”®ï¼šå°†å•ä½ç»å¯¹å®šä½ */
        bottom: 10px;                /* é”šå®šåº•éƒ¨ */
        right: 220px;                 /* é”šå®šå³è¾¹ */
        font-size: 16px;
        margin-left: 6px;
    }
    .today-stats {
      font-size: 16px;
      line-height: 1.4;
      margin-right: 80px;
    }


    /* ä¸­éƒ¨åˆ†ï¼šè¿›ç¨‹ + ç£ç›˜ */
    .charts {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 20px;
      gap: 80px;
      margin-bottom: 16px;
    }
    .chart {
      width: 140px;
      height: 140px;
      margin-left: 50px;
    }
    .disk-info {
      font-size: 12px;
      line-height: 1.4;
      margin-top: 20px;
      margin-right: 50px;
    }

    .separator-line {
      height: 2px;
      background-color: #00aaff;
      margin: 20px 0;
    }

    /* ç£ç›˜ä½¿ç”¨ */
    .cylinder-container {
    width: 100px;
    height: 140px;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    margin-top: -15px;
    }

    /* å¤–è½®å»“ï¼ˆçº¿æ¡†ï¼‰ */
    .cylinder-outline {
    width: 80px;
    height: 120px;
    position: relative;
    border-left: 1px solid rgba(0, 195, 255, 0.4);
    border-right: 1px solid rgba(0, 195, 255, 0.4);
    border-radius: 50% / 10%;
    box-sizing: border-box;
    }

    /* é¡¶éƒ¨æ¤­åœ†è½®å»“ */
    .cylinder-outline::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 16px;
    border-radius: 50%;
    border: 1px solid rgba(0, 195, 255, 0.4);
    }

    /* æ¶²ä½“éƒ¨åˆ† */
    .cylinder-liquid {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 66.6%; /* æ ¹æ®å¡«å……æ¯”ä¾‹è°ƒæ•´ */
    background-color: rgba(43, 173, 230, 0.85);
    border-radius: 0 0 50% 50% / 10% 10% 10% 10%;
    animation: floatLiquid 3s ease-in-out infinite;
    overflow: visible;
    }

    /* æ¶²ä½“é¡¶éƒ¨æ¤­åœ†è½®å»“ */
    .cylinder-liquid::before {
    content: '';
    position: absolute;
    top: -12px; /* é¡¶éƒ¨ç¨å¾®è¶…å‡ºæ¶²ä½“ä¸»ä½“ */
    left: 0;
    width: 100%;
    height: 24px; /* é«˜åº¦è°ƒæ•´å¼§åº¦ */
    background: linear-gradient(to top, #00b4ff, #66d4ff);
    border-radius: 50% / 50%; /* å®Œæ•´æ¤­åœ†å½¢ */
    box-shadow: 0 0 6px rgba(0, 180, 255, 0.85); /* å‘å…‰æ•ˆæœ */
    }

    /* è½»å¾®ä¸Šä¸‹æµ®åŠ¨åŠ¨ç”» */
    @keyframes floatLiquid {
    0%, 100% {
        transform: translateY(0);
        opacity: 0.95;
    }
    50% {
        transform: translateY(-4px);
        opacity: 1;
    }
    }

     /* ä¸‹éƒ¨åˆ†ï¼šç¡¬ä»¶çŠ¶æ€æ¡ */
    .hardware-status label {
      display: block;
      margin: 6px 0 2px;
    }
    .bar {
      background: #03345a;
      height: 15px;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .bar-inner {
      height: 100%;
      width: 0;
      transition: width 0.6s ease;
    }
    .cpu { background-color: #00c3ff86; }
    .mem { background-color: #f7151570; }
    .gpu { background-color: #f1c40f8e; }
/* å·¦ä¸Š end */
</style>

<!-- åœ°å›¾æ•°æ® begin-->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<!-- åœ°å›¾æ•°æ® end -->
<div class="container">
    <!-- å·¦ä¾§å¤§é¢æ¿ -->
    <div class="left-panel">
        <!-- å·¦ä¸Šå°é¢æ¿ï¼Œåˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ† -->
        <div class="left-top">
            <!-- æ¨¡å—A1 -->
            <div class="module">
                <div class="module-title" style="font-size: 18px; color: #fbfcfd; text-align: center; margin-bottom: 10px;">æ•°æ®æ€»é‡</div>
                <!-- æ•°æ®æ€»é‡ä¸ä»Šæ—¥æ–°å¢ -->
                <div class="total-data">
                    <div class="digit-boxes" id="total-boxes"></div>
                    <div class="today-stats">
                        ä»Šæ—¥æ–°å¢ï¼š<span id="today-add">8</span><br />
                        ä»Šæ—¥å¤„ç†ï¼š<span id="today-processed">8</span>
                    </div>
                </div>

                <!-- åˆ†ç•Œçº¿ -->
                <div class="separator-line"></div>

                <!-- åœ†åœˆå›¾ä¸æŸ±çŠ¶å›¾ -->
                <div class="charts">
                    <div class="chart" id="circle-chart"></div>
                    <div>
                        <div style="display: flex; align-items: center;">
                            <!-- <div style="width: 80px; height: 120px; background: linear-gradient(to top, rgba(0,195,255,0.6), rgba(0,255,255,0.2)); border-radius: 50%/10%; position: relative; box-shadow: 0 4px 15px rgba(0, 195, 255, 0.5), inset 0 0 8px rgba(255,255,255,0.2); overflow: hidden;"> -->
                                <!-- åŠ¨æ€å¡«å……éƒ¨åˆ† -->
                                <div class="cylinder-container">
                                    <div class="cylinder-outline">
                                        <div class="cylinder-liquid"></div>
                                    </div>
                                </div>
                            <!-- </div> -->
                            <div class="disk-info" style="text-align: left; margin-top: 60px;">
                                <div>ç£ç›˜ï¼š</div>
                                <div>å·²ä½¿ç”¨ 1000T</div>
                                <div>å‰©ä½™ 1500T</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¡¬ä»¶çŠ¶æ€ -->
                <div class="hardware-status">
                    <label>CPU è¿è¡ŒçŠ¶æ€</label>
                    <div class="bar"><div class="bar-inner cpu" id="cpu-bar"></div></div>

                    <label>å†…å­˜è¿è¡ŒçŠ¶æ€</label>
                    <div class="bar"><div class="bar-inner mem" id="mem-bar"></div></div>

                    <label>GPU è¿è¡ŒçŠ¶æ€</label>
                    <div class="bar"><div class="bar-inner gpu" id="gpu-bar"></div></div>
                </div>
            </div>
            <!-- æ¨¡å—A2 -->
            <div class="module">
                <div class="module-title">æ•°æ®ä¸­å¿ƒåˆ†å¸ƒ</div>
                <!-- <p>å†…å®¹åŒºåŸŸ A2</p> -->
                <!-- åœ°å›¾ -->
                <div id="map-container"></div>
            </div>
        </div>

        
        <!-- å·¦ä¸‹æ¨¡å—B -->
       <!-- æ¨¡å— B -->
       <div class="module">
        <div class="module-title">é±¼ç±»ä»·æ ¼æ•°æ®ç»Ÿè®¡</div>
      
        <!-- åœ°åŒºå’Œé±¼ç§é€‰æ‹© -->
        <div style="display: flex; gap: 10px; margin-bottom: 1px; align-items: center;">
          <label>åœ°åŒºï¼š</label>
          <select id="region" onchange="updateFishPriceChart()">
            <option value="å¹¿ä¸œèŒ‚å">å¹¿ä¸œèŒ‚å</option>
            <option value="é’å²›èƒ¶å·">é’å²›èƒ¶å·</option>
          </select>
          <label>é±¼ç§ï¼š</label>
          <select id="fish" onchange="updateFishPriceChart()">
            <option value="é±¼è‹—">é±¼è‹—</option>
            <option value="è‰é±¼">è‰é±¼</option>
          </select>
        </div>
      
        <!-- å†…å®¹ä¸¤æ å¸ƒå±€ -->
        <div style="display: flex; gap: 2px; align-items: flex-start;">
      
          <!-- å·¦å›¾è¡¨ -->
          <div style="flex: 2;">
            <div style="position: relative; width: 100%; height: 280px;">
                <div style="position: absolute; top: 16px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #00c3ff; z-index: 10;">
                    <span id="region-label">å¹¿ä¸œèŒ‚å</span> <span id="fish-label">é±¼è‹—</span> ä¸ƒå¤©å†…è¡Œæƒ…è¶‹åŠ¿å›¾
                  </div>
              <div id="fish-price-line" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
      
          <!-- å³ä»·æ ¼æ•°æ®å±•ç¤º -->
          <div style="flex: 1.3; background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 4px 4px; font-size: 14px; color: #ffffff; transform: translateY(-20px);">
            <div style="margin-bottom: 12px; font-weight: bold; color: #a0e0ff; display: flex; align-items: center; gap: 6px;">
              å•ä½ <span style="padding: 2px 8px; background-color: #00c853; color: white; border-radius: 16px; font-size: 12px;">å…ƒ/å°¾</span>
            </div>
      
            <div style="background-color: rgba(255,255,255,0.1); padding: 6px 10px; border-radius: 4px; margin-bottom: 6px; font-weight: bold; color: #a0e0ff;">å½“æ—¥ä»·æ ¼</div>
            <div style="margin-left: 10px;">
              <div id="today-price"><span style="color:#ccc">å½“æ—¥å‡ä»·ï¼š</span><span style="color:#fff; font-weight: bold;">--</span></div>
              <div id="compare-price"><span style="color:#ccc">ç›¸å¯¹å‰æ—¥ï¼š</span><span style="color:#fff; font-weight: bold;">--</span></div>
            </div>
      
            <div style="background-color: rgba(255,255,255,0.1); padding: 6px 10px; border-radius: 4px; margin-top: 12px; margin-bottom: 6px; font-weight: bold; color: #a0e0ff;">è¿‘7æ—¥ä»·æ ¼</div>
            <div style="margin-left: 10px;">
              <div id="high-price"><span style="color:#ccc">æœ€é«˜ä»·ï¼š</span><span style="color:#fff; font-weight: bold;">--</span></div>
              <div id="low-price"><span style="color:#ccc">æœ€ä½ä»·ï¼š</span><span style="color:#fff; font-weight: bold;">--</span></div>
              <div id="avg-price"><span style="color:#ccc">å¹³å‡ä»·ï¼š</span><span style="color:#fff; font-weight: bold;">--</span></div>
            </div>
          </div>

        </div>
      </div>
        <!-- çš„èŒƒå›´ -->

    </div>
    <!-- å³ä¾§å°é¢æ¿ -->
    <div class="right-panel">
        <!-- æ¨¡å—C -->
        <div class="combined-module">
            <div class="module-title">ä¼ æ„Ÿå™¨ä¿¡æ¯åŒºå—</div>
            <div class="time-metrics4">
                <div class="metric-item4">
                    <span class="metric-label4">å¹³å‡ä¼ è¾“æ—¶é•¿</span>
                    <span class="metric-value blue-text4" id="avg-transmission-time4">02:45s</span>
                </div>
                <div class="metric-item4">
                    <span class="metric-label4">å¹³å‡å¤„ç†æ—¶é•¿</span>
                    <span class="metric-value blue-text4" id="avg-processing-time4">00:02s</span>
                </div>
            </div>
            <div class="sensor-info4">         
                <div class="device-table4">
                    <div class="table-header4">
                        <span>ç±»å‹</span>
                        <span>ç¼–å·</span>
                        <span>å¤§å°</span>
                    </div>
                    <div class="table-row4">
                        <span>æ°´åº•æ‘„åƒå¤´</span><span>video-1</span><span>4Mb</span>
                    </div>
                    <div class="table-row4">
                        <span>4CIFæ‘„åƒå¤´</span><span>video-2</span><span>128kb</span>
                    </div>
                    <div class="table-row4">
                        <span>ç½‘ç»œæ‘„åƒå¤´</span><span>video-3</span><span>100kb</span>
                    </div>
                    <div class="table-row4">
                        <span>éŸ³å“è®¾å¤‡</span><span>sonar-1</span><span>10kb</span>
                    </div>
                    <div class="table-row4">
                        <span>ä¼ æ„Ÿå™¨è®¾å¤‡</span><span>sensor-1</span><span>2kb</span>
                    </div>
                    <div class="table-row4">
                        <span>æ°”è±¡ç«™</span><span>meteor-1</span><span>500b</span>
                    </div>
                </div>
                
            </div>
            
            <div class="module-title">æ•°æ®åº“ä¿¡æ¯</div>
            <div class="database-stats4">
                <div class="stats-item4">
                    <span class="icon database-icon4">ğŸ’¾</span> <!-- æ•°æ®åº“å›¾æ ‡ -->
                    <span id="db-type4">MySQLï¼ŒHBase</span>
                </div>
                <div class="stats-item4">
                    <span class="icon query-icon4">ğŸ”</span> <!-- æŸ¥è¯¢å›¾æ ‡ -->
                    <span id="query-success4">æŸ¥è¯¢/æˆåŠŸï¼š869æ¬¡</span>
                </div>
                <div class="stats-item4">
                    <span class="icon time-icon4">â±ï¸</span> <!-- æ—¶é’Ÿå›¾æ ‡ -->
                    <span id="avg-query-time4">å¹³å‡è€—æ—¶ï¼š4.67s</span>
                </div>
            </div>
                     <!-- æ˜¾ç¤ºä¸Šæ¬¡æ›´æ–°æ—¶é—´ -->
            <div id="last-updated" style="color: #89c3ff; margin-top: 10px; font-size: 14px;">
                ä¸Šæ¬¡æ›´æ–°æ—¶é—´: <span id="update-time">--</span>
            </div>
    </div>
</div>



<!-- ä»·æ ¼éƒ¨åˆ† start------------------------------------------------------------- -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script>
const mockPriceData = {
  "å¹¿ä¸œèŒ‚å": {
    "é±¼è‹—": [0.31, 0.31, 0.31, 0.31, 0.31, 0.31, 0.28],
    "è‰é±¼": [5.1, 5.2, 5.0, 5.05, 5.2, 5.15, 5.1]
  },
  "é’å²›èƒ¶å·": {
    "é±¼è‹—": [0.30, 0.30, 0.30, 0.31, 0.31, 0.30, 0.30],
    "è‰é±¼": [5.0, 5.1, 5.05, 5.1, 5.2, 5.25, 5.3]
  }
};

const dateLabels = ['05-08', '05-09', '05-10', '05-11', '05-12', '05-13', '05-14'];
const chart = echarts.init(document.getElementById('fish-price-line'));

function updateFishPriceChart() {
  const region = document.getElementById('region').value;
  const fish = document.getElementById('fish').value;
  const prices = mockPriceData[region][fish];

  chart.setOption({
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: dateLabels,
      axisLine: { lineStyle: { color: '#fff' } }
    },
    yAxis: {
      type: 'value',
      axisLine: { lineStyle: { color: '#fff' } },
      splitLine: { show: false }
    },
    series: [{
    name: fish,
    type: 'line',
    data: prices,
    areaStyle: { color: 'rgba(255, 255, 255, 0.5)' },  // å¯é€‰ï¼šæ·¡ç™½è‰²é¢ç§¯
    lineStyle: { color: '#ffffff', width: 3 },
    itemStyle: { color: '#ffffff' }
    }]
  });

  document.getElementById('region-label').textContent = region;
  document.getElementById('fish-label').textContent = fish;

  const today = prices[6];
  const yesterday = prices[5];
  const delta = today - yesterday;
  const trend = delta > 0 ? 'ä¸Šæ¶¨' : (delta < 0 ? 'ä¸‹è·Œ' : 'ä»·æ ¼å¹³ç¨³');
  const rate = (Math.abs(delta / yesterday) * 100).toFixed(2);
  const max = Math.max(...prices).toFixed(2);
  const min = Math.min(...prices).toFixed(2);
  const avg = (prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(2);

  document.getElementById('today-price').innerHTML = `<span style='color:#ccc'>å½“æ—¥å‡ä»·ï¼š</span><span style='color:#fff; font-weight:bold;'>${today.toFixed(2)} å…ƒ/å°¾</span>`;
  document.getElementById('compare-price').innerHTML = `<span style='color:#ccc'>ç›¸å¯¹å‰æ—¥ï¼š</span><span style='color:#fff; font-weight:bold;'>${trend === 'ä»·æ ¼å¹³ç¨³' ? trend : trend + Math.abs(delta).toFixed(2) + 'å…ƒï¼Œå¹…åº¦ ' + rate + '%'}</span>`;
  document.getElementById('high-price').innerHTML = `<span style='color:#ccc'>æœ€é«˜ä»·ï¼š</span><span style='color:#fff; font-weight:bold;'>${max} å…ƒ/å°¾</span>`;
  document.getElementById('low-price').innerHTML = `<span style='color:#ccc'>æœ€ä½ä»·ï¼š</span><span style='color:#fff; font-weight:bold;'>${min} å…ƒ/å°¾</span>`;
  document.getElementById('avg-price').innerHTML = `<span style='color:#ccc'>å¹³å‡ä»·ï¼š</span><span style='color:#fff; font-weight:bold;'>${avg} å…ƒ/å°¾</span>`;
}

document.addEventListener("DOMContentLoaded", updateFishPriceChart);
</script>
<!-- ä»·æ ¼éƒ¨åˆ† end------------------------------------------------------------- -->

<!-- åœ°å›¾partç»˜åˆ¶ -->
<script>
    fetch('https://geo.datav.aliyun.com/areas/bound/geojson?code=100000_full')
        .then(res => res.json())
        .then(geoJson => {
            echarts.registerMap('china', geoJson);
            var myChart = echarts.init(document.getElementById('map-container'));

            var points = [
                {
                    name: 'æ­å·',
                    value: [120.15, 30.28, parseFloat((30+ Math.random() * 4 - 2).toFixed(2))],
                    provider: 'é˜¿é‡Œäº‘',
                    info: 'æ•°æ®ä¸­å¿ƒ',
                    itemStyle: {
                        color: '#00FF99'  // çº¢è‰²
                    }
                },
                {
                    name: 'åŒ—äº¬',
                    value: [116.46, 39.92, parseFloat((25 + Math.random() * 4 - 2).toFixed(2))],
                    provider: 'ç™¾åº¦äº‘',
                    info: 'åŒ—æ–¹èŠ‚ç‚¹',
                    itemStyle: {
                        color: '#FFC300'  // çº¢è‰²
                    }
                },
                {
                    name: 'å¹¿å·',
                    value: [113.23, 23.16, parseFloat((20+ Math.random() * 4 - 2).toFixed(2))],
                    provider: 'è…¾è®¯äº‘',
                    info: 'å—æ–¹èŠ‚ç‚¹',
                    itemStyle: {
                        color: '#D966FF'  
                    }
                },
                {
                    name: 'é‡åº†',
                    value: [106.55, 29.57, parseFloat((22 + Math.random() * 4 - 2).toFixed(2))],  
                    provider: 'åä¸ºäº‘',
                    info: 'è¥¿å—èŠ‚ç‚¹',
                    itemStyle: {
                        color: ' #FF3366' 
                    }
                }
            ];

            var defaultPoint = points[0];
            var infoText = `æ•°æ®ä¸­å¿ƒ\nåœ°ç‚¹ï¼š${defaultPoint.name}\næœåŠ¡å•†ï¼š${defaultPoint.provider}\nè¿æ¥ï¼š${defaultPoint.value[2]}ms`;          

            var option = {
                    tooltip: {
                        trigger: 'item',
                        show: false
                    },
                    
                    geo: {
                        map: 'china',
                        roam: false,
                        zoom: 1.7,
                        center: [110.6, 35.9],
                        label: {
                            show: false,
                            
                        },
                        itemStyle: {//è¾¹ç•Œçº¿
                            areaColor: 'transparent',   
                            borderColor: '#39A7FF',     
                            borderWidth: 1              
                        },
                        emphasis: {
                            label: {
                                show: false,
                            },
                            itemStyle: {
                                areaColor: 'transparent'
                            }
                        }
                    },
                    
                    series: [
                        {
                            name: 'åŸå¸‚',
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            data: points,
                            // symbol: 'pin',
                            symbol: 'path://M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z', 
                            // symbolSize: function (val) {
                            //     return val[2] ;
                            // },
                            symbolSize: function(val) {
                                return [val[2] * 0.95, val[2]*1.2];  // å®½åº¦æ˜¯é«˜åº¦çš„60%
                            },
                            symbolKeepAspect: false,
                            label: {
                                formatter: '{b}',
                                position: 'right',
                                show: false,
                                fontSize: 10,         
                                color: '#ffffff'     
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    fontSize: 20,
                                    color:'#ffffff'
                                }
                            }
                        },
                        {
                            name: 'è¿æ¥çº¿',
                            type: 'lines',
                            coordinateSystem: 'geo',
                            zlevel: 2,
                            effect: {
                                show: true,
                                period: 6,
                                trailLength: 0.2,
                                color: '#fff',
                                symbol: 'arrow',
                                symbolSize: 6
                            },
                            lineStyle: {
                                color: '#00FFFF',
                                width: 1,
                                opacity: 0.6,
                                curveness: 0.2
                            },
                            data: [
                                {
                                    coords: [points[1].value, points[0].value] 
                                },
                                {
                                    coords: [points[3].value, points[0].value]  
                                },
                                {
                                    coords: [points[3].value, points[1].value]  
                                },
                                {
                                    coords: [points[3].value, points[2].value]  
                                }
                            ]
                        }
                    ],         

                    graphic: [
                            {
                                type: 'group',     
                                id: 'infoCard',  
                                left: '71%',       
                                top: '39%',     
                                children: [     
                                {
                                    type: 'rect', 
                                    z: 100,     
                                    left: 0,
                                    top:-5,
                                    shape: { width: 170, height: 100 }, 
                                    style: {
                                        fill: 'rgba(11, 61, 145, 0.85)',  
                                        stroke: '#39A7FF',               
                                        lineWidth: 1,                    
                                        shadowBlur: 10,               
                                        shadowColor: '#000'             
                                    }
                                },
                                {
                                    id: 'infoText',   
                                    type: 'text',      
                                    // left: 'center',
                                    left:20,
                                    z: 200,   
                                    style: {
                                        text:infoText,
                                        font: '14px Microsoft YaHei',
                                        lineHeight: 21,
                                        // align: 'center',
                                        fill: '#E6F7FF',
                                        stroke: '#39A7FF',
                                        lineWidth: 0.3
                                        // shadowBlur: 15,
                                        // shadowColor: 'rgba(0, 255, 255, 0.6)',
                                        
                                
                                }
                                }
                                ]
                            }
                            ]
                };

            myChart.setOption(option);

            function updateValue() {

                defaultPoint.value[2] = parseFloat((point.value[2] + (Math.random() * 4 - 2)).toFixed(2));

                infoText = `æ•°æ®ä¸­å¿ƒ\nåœ°ç‚¹ï¼š${defaultPoint.name}\næœåŠ¡å•†ï¼š${defaultPoint.provider}\nè¿æ¥ï¼š${defaultPoint.value[2]}ms`;
                        
                myChart.setOption({
                    graphic: {
                        elements: [
                            {
                                id: 'infoText',
                                type: 'text',      
                                // left: 'center', 
                                left:-80,
                                style: {
                                    text: infoText,
                                    font: '14px Microsoft YaHei',
                                    lineHeight: 21,
                                    fill: '#E6F7FF',
                                    stroke: '#39A7FF',
                                    lineWidth: 0.3,
                                }
                            }
                        ]
                    }
                });
            }       

            // å¯åŠ¨å®šæ—¶å™¨
            // console.log("kaishiä¸€æ¬¡å®Œæˆ");
            setInterval(updateValue, 10000);
            // console.log("æ‰§è¡Œä¸€æ¬¡å®Œæˆ");
            

            myChart.on('click', function (params) {
                    if (params.seriesType === 'scatter') {
                        defaultPoint = params.data;
                        infoText = `æ•°æ®ä¸­å¿ƒ\nåœ°ç‚¹ï¼š${defaultPoint.name}\næœåŠ¡å•†ï¼š${defaultPoint.provider}\nè¿æ¥ï¼š${defaultPoint.value[2]}ms`;
                        
                        myChart.setOption({
                            graphic: {
                                elements: [
                                    {
                                        id: 'infoText',
                                        type: 'text',      
                                        // left: 'center', 
                                        left:-80,
                                        style: {
                                            text: infoText,
                                            font: '14px Microsoft YaHei',
                                            lineHeight: 21,
                                            fill: '#E6F7FF',
                                            stroke: '#39A7FF',
                                            lineWidth: 0.3,
                                        }
                                    }
                                ]
                            }
                        });
                    }
            });

            window.addEventListener('resize', function() {
                    myChart.resize();
                });
        
        });
</script>


<!-- tww's script  start-->
<script>
    function updateSensorData() {
        // æ›´æ–°ä¼ è¾“æ—¶é•¿
        const avgTransmissionTime = getRandomTime();
        document.getElementById('avg-transmission-time4').textContent = `${avgTransmissionTime}s`;

        // æ›´æ–°å¤„ç†æ—¶é•¿
        const avgProcessingTime = getRandomTime();
        document.getElementById('avg-processing-time4').textContent = `${avgProcessingTime}s`;
    }

    function updateDatabaseStats() {
        // // æ›´æ–°æ•°æ®åº“ç±»å‹
        const dbType = getRandomDbType();
        document.getElementById('db-type4').textContent = dbType;

        // æ›´æ–°æŸ¥è¯¢æˆåŠŸæ¬¡æ•°
        const querySuccess = getRandomQueryCount();
        document.getElementById('query-success4').textContent = `æŸ¥è¯¢/æˆåŠŸï¼š${querySuccess}æ¬¡`;

        // æ›´æ–°å¹³å‡æŸ¥è¯¢è€—æ—¶
        const avgQueryTime = getRandomTime();
        document.getElementById('avg-query-time4').textContent = `å¹³å‡è€—æ—¶ï¼š${avgQueryTime}s`;
        
        // è·å–å¹¶æ˜¾ç¤ºä¸Šæ¬¡æ›´æ–°æ—¶é—´
        const now = new Date();
        const timeString = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        document.getElementById('update-time').textContent = timeString;
    }

    // æ¨¡æ‹Ÿè·å–éšæœºæ—¶é—´
    function getRandomTime() {
        const min = 1; 
        const max = 10; 
        const randomTime = (Math.random() * (max - min) + min).toFixed(2); // ä¿ç•™ä¸¤ä½å°æ•°
        return randomTime;
    }

    // æ¨¡æ‹Ÿè·å–éšæœºæ•°æ®åº“ç±»å‹
    function getRandomDbType() {
        const dbTypes = ['MySQL, HBase', 'MongoDB, Redis', 'PostgreSQL, Cassandra'];
        const randomIndex = Math.floor(Math.random() * dbTypes.length);
        return dbTypes[randomIndex];
    }

    // æ¨¡æ‹Ÿè·å–éšæœºæŸ¥è¯¢æˆåŠŸæ¬¡æ•°
    function getRandomQueryCount() {
        return Math.floor(Math.random() * 1000);
    }

    // æ¯5ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®
    setInterval(() => {
        updateSensorData();
        updateDatabaseStats();
    }, 50000); // æ¯5000æ¯«ç§’ï¼ˆå³5ç§’ï¼‰æ›´æ–°ä¸€æ¬¡


</script>
<!-- tww's script  end-->
<!-- tww's style start-->
<style>

    .sensor-info4 {
        background: rgba(26, 43, 60, 0.3); /* æ˜äº®çš„æ·±è‰²é€æ˜èƒŒæ™¯ */
        padding: 8px; /* æ›´å°çš„å†…è¾¹è· */
        margin: 4px; /* æ›´å°çš„å¤–è¾¹è· */
        border-radius: 6px; /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
        color: #ecf0f1; /* æ›´äº®çš„æ–‡å­—é¢œè‰² */
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2); /* å¢å¼ºé˜´å½±æ•ˆæœï¼Œæå‡å±‚æ¬¡æ„Ÿ */
        backdrop-filter: blur(4px); /* èƒŒæ™¯æ¨¡ç³Šï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿ */
        /* transition: background 0.3s ease, box-shadow 0.3s ease; æ·»åŠ åŠ¨æ€è¿‡æ¸¡æ•ˆæœ */
    }



    /* æ•°æ®åº“ç»Ÿè®¡åŒºå— */
    .database-stats4 {
        background: rgba(26, 43, 60, 0.5); /* æ˜äº®çš„æ·±è‰²é€æ˜èƒŒæ™¯ */
        padding: 12px;
        margin: 12px;
        border-radius: 8px; /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
        color: #ecf0f1; /* æ›´äº®çš„æ–‡å­—é¢œè‰² */
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2); /* å¢å¼ºé˜´å½±æ•ˆæœï¼Œæå‡å±‚æ¬¡æ„Ÿ */
        backdrop-filter: blur(4px); /* èƒŒæ™¯æ¨¡ç³Šï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿ */
        transition: background 0.3s ease, box-shadow 0.3s ease; /* æ·»åŠ åŠ¨æ€è¿‡æ¸¡æ•ˆæœ */
    }

    /* åŠ¨æ€æ•ˆæœï¼šé¼ æ ‡æ‚¬åœæ—¶æ”¹å˜èƒŒæ™¯å’Œé˜´å½± */
    .database-stats4:hover {
        background: rgba(7, 80, 128, 0.9); /* æ›´äº®çš„èƒŒæ™¯é¢œè‰² */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); /* å¢å¼ºé˜´å½±æ•ˆæœ */
    }

    .time-metrics4 {
        display: flex;
        gap: 16px;
        margin-bottom: 20px;
    }

    .metric-item4 {
        background: rgba(58, 83, 106, 0.85); /* æäº®çš„é€æ˜å¡ç‰‡èƒŒæ™¯ */
        text-align: center;
        flex: 1;
        padding: 16px;
        border-radius: 10px; /* æ›´å¤§åœ†è§’ */
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* æ›´åŠ æ˜æ˜¾çš„é˜´å½±æ•ˆæœ */
        transition: background 0.3s ease, transform 0.3s ease; /* æ·»åŠ åŠ¨æ€æ•ˆæœ */
    }

    /* metric-label æ ·å¼è°ƒæ•´ï¼ˆè“è‰²è°ƒï¼‰ */
    .metric-label4 {
        font-size: 16px;
        font-weight: bold;
        color: #3498db; /* äº®è“è‰²å­—ä½“ */
        background: linear-gradient(to right, #74bded, #deb3f1); /* è“è‰²æ¸å˜èƒŒæ™¯ */
        -webkit-background-clip: text; /* èƒŒæ™¯æ¸å˜åº”ç”¨äºæ–‡æœ¬ */
        background-clip: text; /* æ ‡å‡†å±æ€§ */
        color: transparent; /* ä½¿æ–‡æœ¬æœ¬èº«é€æ˜ */
        text-shadow: 1px 1px 6px rgba(0, 0, 0, 0.3); /* å¼ºåŒ–æ–‡æœ¬é˜´å½±æ•ˆæœ */
        transition: color 0.3s ease, text-shadow 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡ */
    }

    /* é¼ æ ‡æ‚¬åœæ—¶çš„åŠ¨æ€æ•ˆæœ */
    .metric-label4:hover {
        color: #cca3ef; /* é¼ æ ‡æ‚¬åœæ—¶æ”¹å˜é¢œè‰²ä¸ºè“ç»¿è‰² */
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5); /* å¢å¼ºæ–‡æœ¬é˜´å½± */
    }



    .table-header4 {
        background: rgba(52, 152, 219, 0.9); /* æ›´äº®çš„è¡¨å¤´èƒŒæ™¯ */
        display: grid;
        grid-template-columns: 2fr 2fr 1fr;
        color: #fff;
        padding: 8px;
        border-radius: 8px;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* è½»å¾®é˜´å½±æ•ˆæœ */
        transition: background 0.3s ease; 
    }



    .table-row4 {
        display: grid;
        grid-template-columns: 2fr 2fr 1fr; /* è°ƒæ•´åˆ—å®½ï¼Œç¡®ä¿å†…å®¹æ›´ç´§å‡‘ */
        padding: 10px; /* å‡å°å†…è¾¹è· */
        border-bottom: 1px solid rgba(52, 152, 219, 0.5); /* æ›´äº®çš„åˆ†éš”çº¿ */
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, background-image 0.3s ease; /* æ·»åŠ æ¸å˜è¿‡æ¸¡æ•ˆæœ */
    }

    /* é¼ æ ‡æ‚¬åœæ—¶çš„åŠ¨æ€æ•ˆæœ */
    .table-row4:hover {
        background-image: linear-gradient(to right, rgba(161, 208, 239, 0.1), rgba(52, 152, 219, 0.3)); /* æ¸å˜èƒŒæ™¯æ•ˆæœ */
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); /* æ·»åŠ é˜´å½±æ•ˆæœ */
        transform: translateY(-5px); /* æ‚¬æµ®æ•ˆæœï¼šå…ƒç´ å‘ä¸Šç§»åŠ¨ */
    }



    /* å•ä¸ªæ•°æ®é¡¹çš„æ ·å¼ */
    .stats-item4 {
        display: flex;
        align-items: center;
        margin-bottom: 8px; /* å‡å°‘æ¯é¡¹ä¹‹é—´çš„é—´è· */
        font-size: 16px; /* è°ƒæ•´å­—ä½“å¤§å° */
        transition: background-color 0.3s ease, transform 0.3s ease; /* åŠ¨ç”»æ•ˆæœ */
    }

    /* å›¾æ ‡æ ·å¼ */
    .icon4 {
        font-size: 18px; /* è°ƒæ•´å›¾æ ‡çš„å¤§å° */
        margin-right: 8px; /* å‡å°‘å›¾æ ‡ä¸æ–‡æœ¬ä¹‹é—´çš„é—´è· */
    }

    /* ä¸ºä¸åŒçš„å›¾æ ‡æŒ‡å®šé¢œè‰² */
    .database-icon4 {
        color: #2980b9; /* è“è‰² */
    }

    .query-icon4 {
        color: #27ae60; /* ç»¿è‰² */
    }

    .time-icon4 {
        color: #f39c12; /* é»„è‰² */
    }

    /* é¼ æ ‡æ‚¬åœæ—¶çš„æ•°æ®é¡¹æ•ˆæœ */
    .stats-item4:hover {
        background-color: rgba(183, 214, 234, 0.2); /* é¼ æ ‡æ‚¬åœæ—¶çš„èƒŒæ™¯é¢œè‰² */
        transform: translateX(5px); /* å‘å³ç§»åŠ¨æ•ˆæœ */
    }

    /* æ¨¡å—æ ‡é¢˜æ ·å¼ */
    .module-title4 {
        font-size: 18px;
        /* font-weight: bold; */
        color: #3498db;
        margin-bottom: 10px; /* å‡å°‘æ ‡é¢˜ä¸å†…å®¹ä¹‹é—´çš„é—´è· */
    }
</style>
<!-- tww's style start-->

<!-- å·¦ä¸Šscriptéƒ¨åˆ† start------------------------------------------------------------- -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>
<script>
    // æ¸²æŸ“æ•°å­—æ¡†
    const total = '01038';
    const totalBox = document.getElementById('total-boxes');
    total.split('').forEach(d => {
      const span = document.createElement('span');
      span.className = 'digit-box';
      span.innerText = d;
      totalBox.appendChild(span);
    });
    const unit = document.createElement('span');
    unit.className = 'unit';
    unit.innerText = 'å•ä½ï¼šT';
    totalBox.appendChild(unit);

    // åœ†åœˆå›¾
    // const circle = echarts.init(document.getElementById('circle-chart'));
    // circle.setOption({
    //   series: [{
    //     type: 'pie',
    //     radius: ['70%', '90%'],
    //     label: {
    //       position: 'center',
    //       formatter: '999\nè¿›ç¨‹æ€»é‡',
    //       fontSize: 16,
    //       color: '#00c3ff',
    //     },
    //     data: [
    //       { value: 900, name: 'used' },
    //       { value: 100, name: 'empty', itemStyle: { color: 'transparent' } }
    //     ]
    //   }],
    //   backgroundColor: 'transparent'
    // });
    const circle = echarts.init(document.getElementById('circle-chart'));
    circle.setOption({
    backgroundColor: 'transparent',
    series: [{
        type: 'pie',
        radius: ['70%', '90%'],
        avoidLabelOverlap: false,
        label: {
        show: true,
        position: 'center',
        formatter: '999\nè¿›ç¨‹æ€»é‡',
        fontSize: 14,
        color: '#fffffc',
        fontWeight: 'bold',
        lineHeight: 24
        },
        data: [
        {
            value: 900,
            name: 'used',
            itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                { offset: 0, color: '#00c3ff' },
                { offset: 1, color: '#0050b3' }
            ])
            },
            emphasis: {
            itemStyle: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 195, 255, 0.7)'
            }
            }
        },
        {
            value: 100,
            name: 'empty',
            itemStyle: {
            color: 'rgba(0,0,0,0.1)'
            }
        }
        ]
    }]
    });



    // åŠ¨æ€è¿›åº¦æ¡
    function updateHardware(cpu, mem, gpu) {
      document.getElementById('cpu-bar').style.width = cpu + '%';
      document.getElementById('mem-bar').style.width = mem + '%';
      document.getElementById('gpu-bar').style.width = gpu + '%';
    }
    setInterval(() => {
        fetch('/hard_status')
            .then(res => res.json())
            .then(({ cpu, mem, gpu }) => {
            updateHardware(cpu, mem, gpu);
            });
    }, 2000);

</script>
<!-- å·¦ä¸Šscriptéƒ¨åˆ† end-->

{% endblock %}